
# ARP

네트워크에서 상대방과 통신하기 위해선 상대 컴퓨터의 ip 주소,  mac 번호등을 알고 있어야 통신이 가능하다.
MAC주소와 ip주소는 네트워크상에서 인식자로 사용되지만, 서로 어떤 상관관계도 없습니다. 그렇기 때문에 목적지의 ip주소를 알고 있더라도, mac주소를 몰라 통신을 할 수 없는 상황도 일어날 수 있습니다.
이러한 상황에서 상대방의 mac주소를 알아내기 위해 사용되는 프로토콜이 arp 입니다.
![[Pasted image 20231006140750.png]]arp은 2계층의 mac주소와 3계층의 ip 주소를 연결하기 위한 프로토콜인데 다음과 같이 구성되어 있습니다.

만약 특정 호스트에서 아무런 통신이 없다가 처음 통신을 시도한다는 가정을 해봅시다.
성공적으로 정확한 주소에 연결을 체결하기 위해선 정확한 정보를 [[인캡슐레이션, 디캡슐레이션]]하는 과정이 필수적입니다.
통신을 시도할때 목적지와 출발지의 ip주소는 알고 있지만, 그 상대의 mac주소는 알 수 없기때문에 바르게 캠슐화를 할 수 없습니다.

이때 arp을 브로드캐스트 하면서 상대방의 mac주소를 질의합니다.
상대방은 arp요청을 받으면 자신의 mac주소를 응답하는데, 그 후, 출발지 컴퓨터에서는 상대의 mac을 기입하여 정확한 패킷을 전송할 수 있게 됩니다.

![[Pasted image 20231006141519.png]]
arp -a 커맨드는 시스템의 arp캐쉬를 보여줍니다.
이는 이전에 연락한 이력이 있는 컴퓨터의 mac주소가 캐쉬형태로 저장되어 있는경우 이를 출력하는 거 같다.

위의 arp 테이블에서 송신자 하드웨어 mac주소, 송신자 ip프로토콜 주소, 대상자 mac 주소, 대상자 ip프로토콜 주소의 4개의 필드가 중요하게 사용됩니다.

예를 들어 데이터를 요청하기위해 패킷을 만드는 상황을 생각해보자. (일반 패킷)

|출발지 mac| 목적지 mac| 출발지 ip| 목적지 ip| 
|     AA.        |         -         | 1.1.1.1.    | 1.1.1.2.   |

와 같은 데이터가 입력 될텐데, 정상적인 송수신을 위해선 목적지의 mac주소도 함께 들어가야 하지만, 알 수 없으니 삽입할 수 가 없다.

이럴때는 arp 패킷을 만들어 브로드캐스트 해야한다.
arp 패킷을 브로드캐스트 할때는 2계층 mac주소는 자신의 mac 주소를, 목적지 mac주소는 
ff-ff-ff-ff-ff-ff로 채웁니다.
이때 대상자 mac은  00으로 채웁니다

![[Pasted image 20231006143231.png]]
**지피티가 알려준 arp패킷 예시**

arp패킷은 모든 수신자가 확인을 해야하는데, 만약 명시 된 ip주소가 자신의 것이 아니면 버립니다.
자신의 것이 맞다면 arp주소에 명시 된 상대의 ip 주소와 mac 주소를 업데이트하여 저장하고, 답장합니다.
그렇기 때문에 맨처음 보내는 arp패킷은 브로드캐스트의 형식으로 보내지지만, 그 답장은 유니캐스트 형식으로 옵니다.
수신자 서버에서는 arp패킷의 데이터를 arp캐시 테이블에 저장하고, 이는 해당 서버와 통신이 한동안 없어질때 까지 유지됩니다.


GARP와 RARP는  arp의 프러터컬 필드를 그대로 사용하지만 필드 내용을 달리해 다른 목적으로 사용합니다 .

# GARP


GARP는 Gratuitous ARP의 약자로 대상자 ip대신 자신의 ip를 채워 네트워크의 호스트들에게 자신의 MAC주소를 전파합니다.
![[Pasted image 20231006143941.png]]
[[wireShark]]에서 garp 패킷을 뜯어본 결과입니다.
해당 패킷을 살펴보면 10.0.0.1의 ip를 가진 호스트가 garp패킷을 전송한 것을 확인 할 수 있습니다.
또한 출발지와 목적지의 ip주소가 동일한 것을 확인할 수 있습니다.
GARP를 사용하는 목적은 다음과 같습니다
	1. ip 주소 충돌방지 - 만약 다른 사람이 같은 ip를 쓰고 있으면 garp에 대한 응답이 옴.
	2. 상대방의 arp 테이블갱신
	3. ha(고가용성) 용도의 클러스터링, VRRP, HSRP

2.번의 경우는 하나의 스위치를 두고 2대의 같은 ip를 가진 데이터베이스가 하나는 액티브로, 하나는 스탠바이로 동작할때 일어날 수 있습니다.

만약 하나의 데이터베이스와 통신하고 있는 서버는 액티브 되어있는 a데이터베이스가 고장이 나도 계속 해당 장소로 패킷을 보낼 텐데, 이는 arp 캐시테이블에는 여전이 고장난 db의 mac주소가 저장이 되어 있을 가능성이 높기 때문입니다.
이때가 garp을 보내기 적합할 때입니다.

스탠바이 상태에 있던 db는 액티브상태로 전환 함과 동시에 garp패킷을 보내 arp주소를 갱신합니다.  캐시 데이터가 갱신이 된 서버는 이제 b데이터베이스로 정상적인 패킷을 보낼 수 있습니다.

# RARP

RARP는 Reverse ARP란 뜻으로 ip주소를 알지만 mac주소를 모를때 쓰는 arp와 달리 mac주소는 알지만 ip주소를 모를때 사용하는 것입니다.
BOOTP와 DHCP로 대체되어 이제 사용되지 않습니다.(deprecated)