
it 에서는 SPoF를 방지하는것을 중요한 테스크중 하나로 생각합니다.
SPoF는 single point of Failure의 약자로 스위치의 경우 하나의 스위치가 망가지면 연결 된 모든 네트워크가 작동을 안할 수 있습니다.
이경우엔 스위치가 SPoF가 될 수 있습니다.

이를 방지하기 위해선 네트워크에  여러개의 스위치를 연결 하도록 할 수 있는데, 이때는 스위치의 패킷이 순환는 구조인 루프가 발생할 수 있습니다.
루프가 발생하면 브로드캐스트 스톰과 같은 문제가 발생할 수 있습니다.

## 브로드캐스트 스톰

스위치에 브로드캐스트가 유입되면, 스위치는 해당 패킷을 유입 된 포트를 제외한 모든 포트에 플러딩 합니다.
만약, 루프 구조로 스위치가 맞물려 돌아가는 상황이라면 패킷은 네트워크상에서 영구적으로 순환합니다.
3계층과 같은 경우엔 TTL과 같이 패킷의 수명을 지정할 수 있지만 2계층에서는 그런것이 없 처리가 힘듭니다.

## mac중복 러닝
유니캐스트에도 문제가 생길 수 있습니다.
스위치는 mac의 주소를 학습할 때 input포트의 출발지 mac주소를 기반으로 테이블을 업데이트 하는데, 유니캐스트 패킷이 루프 구조에서 여러 스위치를 순환 후 들어가게 된다면, 인풋 패킷에 대한 혼란이 생길 수 있습니다.

이를 mac 어드래스 플래핑 이라고 합니다.

스위치상에서 루프가 발생하면 생기는 문제점들을 알아보았습니다.
이제 이를 해결하는 방법

# STP
STP(Spanning Tree Protocol)은 루프를 확인하고 적절히 포트를 사용하지 못하게 만들어 루프를 예방하는 메커니즘.
이를 위해선 전제 스위치가 어떻게 연결 되어있는지 알아야 한다.
그렇게 하기 위해선 스위치간에 정보를 전달하는 방법이 필요한데 BPDU를 통해서 스위치 간에 정보를 전달하고 수집된 정보를 이용해 루프구간을 확인합니다.


## 상태변경및 변경과정
루프를 막기위해서 스위치 포트에 신규 스위치가 연결되면 바로 트래픽이 흐르지 않게 차단합니다.
그후 BPDU를 기다려 학습하고 정상적인 경우 트래픽을 흘리고, 루프구조인 경우 차단상태를 유지합니다.

아래의 4가지 상태를 가집니다.
-Blocking
	초기 차단상태, 상대가 보내는 BPDU를 기다립니다.
	BPDU를 받지 못했거나 후순위 의 것을 받았을때 리스닝 상태로 변경
-Listening
	해당포트가 전송 상태롤 변경되는 것을 결정하고 준비하는 단계.
	자신의 BPDU를 상대에게 전송하기 시작
-Learning
	패킷을 포워딩 하기로 결정하고, 바로 보낼 수 있게 MAC주소를 러닝하는 단계
-Forwarding
	패킷 포워딩

루프를 방어하기 위해 매우 방어적으로 동작하기 때문에 새 스위치를 연결하는데 50초 정도가 소요됩니다.



