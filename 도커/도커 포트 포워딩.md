# 네트워크 기초와 도커(2회차)-권택용

도커 네트워크에 대해 공부하자

도커내부에서 네트워크가 어떻게 작동하는지 알아보기 위해선 기존 방식의 네트워크 작동방식을 이해해야 함.
도커 네트워크에는 bridged, overlay, host, IPvlan등등 다양한 방식이 있지만 오늘은 bridge방식에 대해 설명해 보겠습니다.

네트워크상 모든 웹서버, 공유기, 네트워크 장비들은 ip주소라는 체계화 된 주소를 갖는다. 우리에게 익숙한 [google.com](http://google.com) 과 같은 도메인도 사실 특정 ip주소에 할당 되어 있다.


![](https://i.imgur.com/tSA7PQH.png)



우리는 외부 웹서버들(ex. [google.com](http://google.com))에 접근하기 위해 www.google.com과 같은 도메인 이름으로 접근 하는데, 이는 사실 컴퓨터나 네트워크 장비가 알아먹을 수 있는 구조가 아니라서, 도메인 서버에 해당 서버에 할당 된 ip주소를 물음으로써 컴퓨터는 네트워크에 접근할 수 있다.


현재 메인으로 사용하는 ip주소 프로토콜은 ipv4로 총 32비트의 주소로 할당 되어 있다.

총 0.0.0.0 에서 255.255.255.255에서 할당 될 수 있다는 것을 알 수 있는데, 이는 총 43억개 정도의 ip주소로 전세계인의 수가 80억에 다다른다는 점, 인당 단말기를 2~3개씩은 들고 다닌 다는 점을 고려할때, 턱없이 부족한 수로, 이를 위해 private network라는 기술로 ip주소 부족 현상을 효과 적으로 해결함.

네트워크에서 활동을 하기 위해선 공인 ip주소가 필요한데, 이를 모든 단말기에 배정할 수 없는 상황이기 때문에, 통신허가를 받은 특정한 사람에게 허가하고, ip주소를 배정하는데, 가장 흔하게 볼 수 있는 기기는 우리가 흔히 쓰는 공유기 입니다.

공유기는 네트워크와 연결되기 위해 공인 ip주소를 할당받고, 자신과 연결 된 기기들은 내부 네트워크로 연결하고, 자체적인 ip주소를 할당하는데, 가정에서 흔히 쓰이는 공유기와 같은 경우는 192.168.0.2~ 192.168.0.255의 ip들을 주로 할당합니다.

공유기는 자신과 연결 된 내부 기기들과 외부 네트워크를 연결하기 위해, NAT테이블로 이들을 관리합니다. NAT테이블은 자신을 경유하는 패킷들의 로컬 ip주소와 목적이 ip주소를 매핑하여 저장하는 기술인데, 이를 통해 로컬 ip주소와 외부 ip주소를 연결해 패킷이 잘 연결되도록 합니다.


가령 공유기에 연결된 기기의 로컬 주소가 10.10.10.10이고 125.209.222.142의 외부 네트워크에 접근하고자 한다면, 공유기나 NAT장비들은 이를 수신하고, 자신의 단말기에 기록합니다. ←(1)

기록을 마친 공유기는 출발지 ip주소를 자신의 공인 ip주소로 바꾼 후, 해당 목적지의 ip주소로 가는 패킷을 생성합니다. 이를 통해, 공인 ip를 직접적으로 부여받지 못한 로컬 디바이스는 공인 ip를 사용해 외부 네트워크에 접근할 수 있습니다 ← (2)

외부 네트워크의 서버는 해당 패킷을 수신하고 그에 대한 응답으로 수신한 패킷의 출발지 ip를 도착지 ip로 설정한 패킷을 전송합니다 ← (3)

패킷을 수신한 공유기는 nat테이블을 참고하여 로컬 네트워크에 전송합니다.

이와 같은 방식을 NAT이라고 합니다.

도커에서 bridged 방식으로 연결할때도 위와 유사하게 행동합니다 

도커에서는 bridge network를 네트워크 별로 트래픽을 포워드 하는 링크 레이어 라고 설명하는데, 이 브릿지는 하드웨어 디바이스가 될 수도 있고, 호스트 컴퓨터 커널에서 동작하는 소프트웨어가 될 수 있습니다. 
https://www.docker.com/wp-content/uploads/2022/12/networking-drivers-use-cases-3.png

